<app-header></app-header>

<div class="agendamento-container">
  <div class="agendamento-card">
    <h1>Agendamento de Consulta</h1>
    
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>

    <form [formGroup]="agendamentoForm" (ngSubmit)="onSubmit()">
      <div class="form-section">
        <h2>Informações Pessoais</h2>
        
        <div class="form-group">
          <label for="nome">Nome completo</label>
          <input 
            type="text" 
            id="nome" 
            formControlName="nome" 
            placeholder="Digite seu nome completo"
          >
          <div *ngIf="agendamentoForm.get('nome')?.invalid && agendamentoForm.get('nome')?.touched" class="error-text">
            Nome é obrigatório
          </div>
        </div>

        <div class="form-group">
          <label for="email">E-mail</label>
          <input 
            type="email" 
            id="email" 
            formControlName="email" 
            placeholder="Digite seu e-mail"
          >
          <div *ngIf="agendamentoForm.get('email')?.invalid && agendamentoForm.get('email')?.touched" class="error-text">
            E-mail válido é obrigatório
          </div>
        </div>

        <div class="form-group">
          <label for="telefone">Telefone</label>
          <input 
            type="tel" 
            id="telefone" 
            formControlName="telefone" 
            placeholder="Digite seu telefone"
          >
          <div *ngIf="agendamentoForm.get('telefone')?.invalid && agendamentoForm.get('telefone')?.touched" class="error-text">
            Telefone é obrigatório
          </div>
        </div>
      </div>

      <div class="form-section">
        <h2>Informações da Consulta</h2>
        
        <div class="form-group">
          <label for="especialidade">Especialidade</label>
          <select 
            id="especialidade" 
            formControlName="especialidade_id"
          >
            <option value="">Selecione uma especialidade</option>
            <option *ngFor="let especialidade of especialidades" [value]="especialidade.id">
              {{ especialidade.nome }}
            </option>
          </select>
          <div *ngIf="agendamentoForm.get('especialidade_id')?.invalid && agendamentoForm.get('especialidade_id')?.touched" class="error-text">
            Especialidade é obrigatória
          </div>
        </div>

        <div class="form-group">
          <label for="medico">Médico</label>
          <select 
            id="medico" 
            formControlName="medico_id"
            [disabled]="!agendamentoForm.get('especialidade_id')?.value"
          >
            <option value="">Selecione um médico</option>
            <option *ngFor="let medico of medicos" [value]="medico.id">
              {{ medico.nome }}
            </option>
          </select>
          <div *ngIf="agendamentoForm.get('medico_id')?.invalid && agendamentoForm.get('medico_id')?.touched" class="error-text">
            Médico é obrigatório
          </div>
        </div>

        <div class="form-group">
          <label for="disponibilidade">Data e Horário</label>
          <select 
            id="disponibilidade" 
            formControlName="disponibilidade_id"
            [disabled]="!agendamentoForm.get('medico_id')?.value"
          >
            <option value="">Selecione uma data e horário</option>
            <option *ngFor="let disponibilidade of disponibilidades" [value]="disponibilidade.id">
              {{ formatarDataHora(disponibilidade.data_hora) }}
            </option>
          </select>
          <div *ngIf="agendamentoForm.get('disponibilidade_id')?.invalid && agendamentoForm.get('disponibilidade_id')?.touched" class="error-text">
            Data e horário são obrigatórios
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button 
          type="submit" 
          class="btn-agendar" 
          [disabled]="agendamentoForm.invalid || loading"
        >
          {{ loading ? 'Processando...' : 'Agendar Consulta' }}
        </button>
      </div>
    </form>
  </div>
</div>