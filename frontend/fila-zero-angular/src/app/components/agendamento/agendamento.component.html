<app-header></app-header>

<!-- Modal de sucesso -->
<div *ngIf="showSuccessModal" class="success-modal-overlay">
  <div class="success-modal">
    <div class="success-icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#4CAF50" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
        <polyline points="22 4 12 14.01 9 11.01"></polyline>
      </svg>
    </div>
    <h2>Agendamento Confirmado!</h2>
    <p>Sua consulta foi agendada com sucesso para <strong>{{ agendamentoInfo }}</strong>.</p>
    <button class="btn-primary" (click)="fecharModal()">Ver Meus Agendamentos</button>
  </div>
</div>

<div class="agendamento-container">
  <div class="agendamento-card">
    <h1>Agendamento de Consulta</h1>
    
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>

    <form [formGroup]="agendamentoForm" (ngSubmit)="onSubmit()">
      <div class="form-section">
        <h2>Informações Pessoais</h2>
        
        <div class="form-group">
          <label for="nome">Nome completo</label>
          <input 
            type="text" 
            id="nome" 
            formControlName="nome" 
            placeholder="Digite seu nome completo"
          >
          <div *ngIf="agendamentoForm.get('nome')?.invalid && agendamentoForm.get('nome')?.touched" class="error-text">
            Nome é obrigatório
          </div>
        </div>

        <div class="form-group">
          <label for="email">E-mail</label>
          <input 
            type="email" 
            id="email" 
            formControlName="email" 
            placeholder="Digite seu e-mail"
          >
          <div *ngIf="agendamentoForm.get('email')?.invalid && agendamentoForm.get('email')?.touched" class="error-text">
            E-mail válido é obrigatório
          </div>
        </div>

        <div class="form-group">
          <label for="telefone">Telefone</label>
          <input 
            type="tel" 
            id="telefone" 
            formControlName="telefone" 
            placeholder="Digite seu telefone"
          >
          <div *ngIf="agendamentoForm.get('telefone')?.invalid && agendamentoForm.get('telefone')?.touched" class="error-text">
            Telefone é obrigatório
          </div>
        </div>
      </div>

      <div class="form-section">
        <h2>Informações da Consulta</h2>
        
        <div class="form-group">
          <label for="especialidade">Especialidade</label>
          <select 
            id="especialidade" 
            formControlName="especialidade_id"
          >
            <option value="">Selecione uma especialidade</option>
            <option *ngFor="let especialidade of especialidades" [value]="especialidade.id">
              {{ especialidade.nome }}
            </option>
          </select>
          <div *ngIf="agendamentoForm.get('especialidade_id')?.invalid && agendamentoForm.get('especialidade_id')?.touched" class="error-text">
            Especialidade é obrigatória
          </div>
        </div>

        <div class="form-group">
          <label for="medico">Médico</label>
          <select 
            id="medico" 
            formControlName="medico_id"
            [disabled]="!agendamentoForm.get('especialidade_id')?.value"
          >
            <option value="">Selecione um médico</option>
            <option *ngFor="let medico of medicos" [value]="medico.id">
              {{ medico.nome }}
            </option>
          </select>
          <div *ngIf="agendamentoForm.get('medico_id')?.invalid && agendamentoForm.get('medico_id')?.touched" class="error-text">
            Médico é obrigatório
          </div>
        </div>

        <div class="form-group">
          <label for="data">Data</label>
          <select 
            id="data" 
            formControlName="data_selecionada"
            [disabled]="!agendamentoForm.get('medico_id')?.value || datasDisponiveis.length === 0"
          >
            <option value="">{{ datasDisponiveis.length > 0 ? 'Selecione uma data' : 'Nenhuma data disponível' }}</option>
            <option *ngFor="let data of datasDisponiveis" [value]="data">
              {{ formatarData(data) }}
            </option>
          </select>
          <div *ngIf="agendamentoForm.get('data_selecionada')?.invalid && agendamentoForm.get('data_selecionada')?.touched" class="error-text">
            Data é obrigatória
          </div>
        </div>

        <div class="form-group">
          <label for="horario">Horário</label>
          <select 
            id="horario" 
            formControlName="disponibilidade_id"
            [disabled]="!agendamentoForm.get('data_selecionada')?.value || horariosDisponiveis.length === 0"
          >
            <option value="">{{ horariosDisponiveis.length > 0 ? 'Selecione um horário' : 'Nenhum horário disponível' }}</option>
            <option *ngFor="let disponibilidade of horariosDisponiveis" [value]="disponibilidade.id">
              {{ formatarHora(disponibilidade.hora) }}
            </option>
          </select>
          <div *ngIf="agendamentoForm.get('disponibilidade_id')?.invalid && agendamentoForm.get('disponibilidade_id')?.touched" class="error-text">
            Horário é obrigatório
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button 
          type="submit" 
          class="btn-agendar" 
          [disabled]="agendamentoForm.invalid || loading"
        >
          {{ loading ? 'Processando...' : 'Agendar Consulta' }}
        </button>
      </div>
    </form>
  </div>
</div>